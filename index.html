<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Wedabime Pramukayo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg-dark: #002200; --text-neon: #39FF14; --card-bg: #003300; }
        body { background-color: var(--bg-dark); color: var(--text-neon); font-family: 'Courier New', monospace; }
        .tech-card { background-color: var(--card-bg); border-radius: 15px; border: 1px solid #004400; padding: 20px; }
        .nav-btn { border-bottom: 2px solid transparent; transition: 0.3s; padding: 5px 10px; cursor: pointer; }
        .nav-btn.active { border-color: #39FF14; color: white; }
        input { background-color: #001100; border: 1px solid #39FF14; color: white; padding: 10px; border-radius: 5px; }
        /* Status Colors */
        .status-badge { padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .status-quotation { background: orange; color: black; }
        .status-pending { background: yellow; color: black; }
        .status-completed { background: green; color: white; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="loginSection" class="flex items-center justify-center min-h-screen">
        <div class="tech-card w-full max-w-sm text-center">
            <h1 class="text-2xl font-bold mb-4 text-white">SYSTEM ACCESS</h1>
            <input type="password" id="passwordInput" class="w-full text-center mb-4" placeholder="Access Code">
            <button onclick="checkLogin()" class="w-full bg-[#39FF14] text-black font-bold py-2 rounded">LOGIN</button>
        </div>
    </div>

    <div id="appSection" class="hidden max-w-6xl mx-auto">
        
        <div class="flex gap-6 mb-8 border-b border-[#004400] pb-2 text-sm font-bold uppercase tracking-widest">
            <span id="navReg" class="nav-btn active" onclick="showTab('registration')">Registration</span>
            <span id="navView" class="nav-btn" onclick="showTab('viewCustomers')">View Customers</span>
        </div>

        <div id="registrationTab" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="tech-card">
                <h2 class="text-white font-bold mb-4 uppercase">New Registration</h2>
                <div class="flex flex-col gap-3">
                    <input id="name" type="text" placeholder="Customer Name">
                    <input id="address" type="text" placeholder="Address">
                    <input id="phone" type="text" placeholder="Phone">
                    <input id="totalValue" type="number" placeholder="Total Value">
                    <button onclick="submitCustomer()" id="submitBtn" class="btn-neon w-full py-3 rounded mt-2"> REGISTER </button>
                </div>
            </div>
            
            <div class="tech-card">
                <h2 class="text-white font-bold mb-4 uppercase">Live Stats</h2>
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <div id="viewCustomersTab" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-white font-bold uppercase">Customer Records</h2>
                <button onclick="fetchAllCustomers()" class="text-xs border border-[#39FF14] px-3 py-1 rounded">REFRESH LIST ‚Üª</button>
            </div>
            
            <input type="text" id="searchInput" onkeyup="searchCustomers()" placeholder="Search by name or ID..." class="w-full mb-6">

            <div id="customerGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <p class="text-gray-500">Loading customers...</p>
            </div>
        </div>

    </div>

    <script>
        const WEB_APP_URL = "‡∂î‡∂∂‡∑ö_URL_‡∂ë‡∂ö_‡∂∏‡∑ô‡∑Ñ‡∑í_‡∂Ø‡∂∏‡∂±‡∑ä‡∂±";
        let allCustomers = [];

        function checkLogin() {
            const passInput = document.getElementById("passwordInput");
            const loginError = document.getElementById("loginError");
    
            // üîê Password ‡∂ë‡∂ö ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
            if (passInput.value === "admin123") {
                // Login ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö ‡∂±‡∂∏‡∑ä Login Section ‡∂ë‡∂ö ‡∑Ñ‡∂Ç‡∂ú‡∂Ω‡∑è App Section ‡∂ë‡∂ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("appSection").classList.remove("hidden");
                document.getElementById("appSection").style.display = "grid"; 
        
                // ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫‡∂ß ‡∂á‡∂≠‡∑î‡∑Ö‡∑î ‡∑Ä‡∑ñ ‡∑É‡∑ê‡∂´‡∑í‡∂±‡∑ä Dashboard ‡∂ë‡∂ö load ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                updateDashboard(); 
            } else {
                // ‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂∏‡∑î‡∂ª‡∂¥‡∂Ø‡∂∫‡∂ö‡∑ä ‡∂±‡∂∏‡∑ä Error ‡∂ë‡∂ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
                loginError.classList.remove("hidden");
                passInput.style.borderColor = "red";
                passInput.value = ""; // Input ‡∂ë‡∂ö clear ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            }
        }

        function showTab(tabName) {
            document.getElementById('registrationTab').classList.add('hidden');
            document.getElementById('viewCustomersTab').classList.add('hidden');
            document.getElementById('navReg').classList.remove('active');
            document.getElementById('navView').classList.remove('active');

            if(tabName === 'registration') {
                document.getElementById('registrationTab').classList.remove('hidden');
                document.getElementById('navReg').classList.add('active');
            } else {
                document.getElementById('viewCustomersTab').classList.remove('hidden');
                document.getElementById('navView').classList.add('active');
                fetchAllCustomers(); // ‡∂Ö‡∂Ω‡∑î‡∂≠‡∑í‡∂±‡∑ä Data ‡∂ú‡∑ö‡∂±‡∑ä‡∂±
            }
        }

        async function submitCustomer() {
            const btn = document.getElementById("submitBtn");
            
            // Input Fields ‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
            const name = document.getElementById("name").value;
            const address = document.getElementById("address").value;
            const phone = document.getElementById("phone").value;
            const totalValue = document.getElementById("totalValue").value;

            // ‡∑É‡∑ö‡∑Ä‡∑è‡∑Ä‡∂±‡∑ä (Checkboxes) ‡∑Ä‡∂Ω ‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
            const gutterVal = getServiceStatus("Gutter");
            const ceilingVal = getServiceStatus("Ceiling");
            const roofVal = getServiceStatus("Roof");

            // ‡∂Ö‡∂≠‡∑ä‚Äç‡∂∫‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂≠‡∑í‡∂∂‡∑ö‡∂Ø‡∑ê‡∂∫‡∑í ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
            if(!name || !phone) {
                alert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∂∏ ‡∑É‡∑Ñ ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!");
                return;
            }

            const payload = {
                action: "create",
                name: name,
                address: address,
                phone: phone,
                gutter: gutterVal,
                ceiling: ceilingVal,
                roof: roofVal,
                totalValue: totalValue
            };

            // ‡∂∂‡∑ú‡∂≠‡∑ä‡∂≠‡∂∏ ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ (Double click ‡∑Ä‡∑ê‡∑Ö‡∑ê‡∂ö‡∑ä‡∑Ä‡∑ì‡∂∏‡∂ß)
            btn.disabled = true;
            btn.innerText = "SAVING...";

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: "POST",
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                
                if(result.result === "success") {
                    alert("‚úÖ ‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í‡∂∫ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í! ‡∂¥‡∑è‡∂ª‡∑í‡∂∑‡∑ù‡∂ú‡∑í‡∂ö ID: " + result.id);
                    
                    // Form ‡∂ë‡∂ö Clear ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                    document.getElementById("name").value = "";
                    document.getElementById("address").value = "";
                    document.getElementById("phone").value = "";
                    document.getElementById("totalValue").value = "";
                    
                    // Checkboxes Uncheck ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                    document.querySelectorAll('.service-check').forEach(cb => cb.checked = false);
                    
                    // Dashboard ‡∂ë‡∂ö ‡∑É‡∑Ñ Chart ‡∂ë‡∂ö Update ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                    updateDashboard(); 
                }
            } catch (e) {
                console.error(e);
                alert("‚ùå ‡∑É‡∂ª‡∑ä‡∑Ä‡∂ª‡∑ä ‡∂ë‡∂ö‡∂ß ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö. ‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑ä‡∂¢‡∑è‡∂Ω‡∂∫ ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
            } finally {
                btn.disabled = false;
                btn.innerText = "REGISTER";
            }
        }
    </script>
</body>
</html>